!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.oe=function(e){process.nextTick((function(){throw e}))},n(n.s=11)}([function(e,t){e.exports=require("isomorphic-fetch")},function(e,t){e.exports=require("qrcode")},function(e,t){e.exports=require("kjua")},function(e,t){},function(e,t){},function(e,t){},function(e,t){e.exports=require("es6-promise")},function(e,t){e.exports=require("es6-object-assign")},function(e,t){e.exports=require("qrcode-terminal")},function(e,t){e.exports=require("eventsource")},function(e,t){},function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),i=n(1),s=n.n(i),u=n(2),a=n.n(u),c=(n(10),n(3)),d=n.n(c),l=n(4),p=n.n(l),f=n(5),m=n.n(f),w={en:{Common:{WaitData:"Waiting for data...",Cancel:"Cancel"},Messages:{FollowInstructions:"Please follow the instructions in your IRMA app"},Sign:{Title:"signature request",Body:"A website requests that you sign a message using some of your IRMA attributes. Please scan the QR code with your IRMA app."},Verify:{Title:"attribute request",Body:"A website requests that you disclose some of your IRMA attributes. Please scan the QR code with your IRMA app."},Issue:{Title:"attribute issuance",Body:"A website wishes to issue IRMA attributes to you. Please scan the QR code with your IRMA app."}},nl:{Common:{WaitData:"Wachten op data...",Cancel:"Annuleren"},Messages:{FollowInstructions:"Volg de instructies in uw IRMA app."},Sign:{Title:"verzoek om te tekenen",Body:"Een website vraagt u een bericht te ondertekenen met enkele van uw IRMA attributen. Scan de QR code met uw IRMA app."},Verify:{Title:"verzoek om attributen",Body:"Een website vraagt u enkele van uw IRMA attributen te tonen. Scan de QR code met uw IRMA app."},Issue:{Title:"attributenuitgifte",Body:"Een website wil u enkele IRMA attributen geven. Scan de QR code met uw IRMA app."}}};function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"SessionStatus",(function(){return y})),n.d(t,"setLoggingState",(function(){return I})),n.d(t,"handleSession",(function(){return k})),n.d(t,"setupSession",(function(){return E})),n.d(t,"finishSession",(function(){return A})),n.d(t,"startSession",(function(){return R})),n.d(t,"signSessionRequest",(function(){return M})),n.d(t,"waitConnected",(function(){return x})),n.d(t,"waitDone",(function(){return C})),n.d(t,"UserAgent",(function(){return j})),n.d(t,"detectUserAgent",(function(){return U})),n(6).polyfill(),n(7).polyfill();var h="undefined"!=typeof window,v=h?void 0:n(8),b=h?void 0:n(9),y={Initialized:"INITIALIZED",Connected:"CONNECTED",Cancelled:"CANCELLED",Done:"DONE",Timeout:"TIMEOUT"},S={method:"popup",element:"irmaqr",language:"en",showConnectedIcon:!0,returnStatus:y.Done,server:"",token:"",resultJwt:!1,legacyResultJwt:!1,disableMobile:!1,qrterminalOptions:{},qrterminalDisplay:console.log},q=!0;function I(e){q=e}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return E(e,n,t).then((function(e){return A(e,n)}))}function E(e,t,n){return t.qr=e,t.done=!1,Promise.resolve().then((function(){switch(L("Session started",t.qr),t.options=function(e){L("Options:",e);var t=Object.assign({},S,e);t.userAgent=U(),h&&!t.disableMobile&&t.userAgent!==j.Desktop&&("mobile"!==t.method&&L("On mobile; using method mobile instead of "+t.method),t.method="mobile");switch(t.method){case"url":break;case"mobile":if(t.returnStatus!==y.Done)throw new Error("On mobile sessions, returnStatus must be Done");break;case"popup":if(!h)throw new Error("Cannot use method popup in node");if(!(t.language in w))throw new Error("Unsupported language, currently supported: "+Object.keys(w).join(", "));t.element="modal-irmaqr",t.returnStatus=y.Done;break;case"canvas":if(!h)throw new Error("Cannot use method canvas in node");if("string"!=typeof t.element||""===t.element)throw new Error("canvas method requires `element` to be provided in options");break;case"console":if(h)throw new Error("Cannot use console method in browser");break;default:throw new Error("Unsupported method")}if("string"!=typeof t.server)throw new Error("server must be a string (URL)");if(t.server.length>0&&t.returnStatus!==y.Done)throw new Error("If server option is used, returnStatus option must be SessionStatus.Done");if(t.server.length>0&&("string"!=typeof t.token||0===t.token.length))throw new Error("if server option is used, providing token option is required");if(t.resultJwt&&0===t.server.length)throw new Error("resultJwt option was enabled but no server to retrieve result from was provided");if(t.resultJwt&&t.legacyResultJwt)throw new Error("resultJwt and legacyResultJwt options cannot be simultaneously enabled");return t}(n),t.method=t.options.method,t.method){case"url":return t.done=!0,s.a.toDataURL(JSON.stringify(t.qr));case"mobile":!function(e,t){var n="qr/json/"+encodeURIComponent(JSON.stringify(e));if(t===j.Android){var o="intent://"+n+"#Intent;package=org.irmacard.cardemu;scheme=cardemu;l.timestamp="+Date.now()+";S.browser_fallback_url=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dorg.irmacard.cardemu;end";L("Navigating:",o),window.location.href=o}else t===j.iOS&&(L("Navigating:","irma://"+n),window.location.href="irma://"+n)}(e,t.options.userAgent);break;case"popup":!function(e,t){(function(){if(!h||window.document.getElementById("irma-modal"))return;var e=window.document.createElement("div");e.id="irma-modal",e.innerHTML=m.a,window.document.body.appendChild(e);var t=window.document.createElement("div");t.classList.add("irma-overlay"),window.document.body.appendChild(t),e.offsetHeight})(),n=e.irmaqr,o=t,B("irma-cancel-button","Common.Cancel",o),B("irma-title",N[n]+".Title",o),B("irma-text",N[n]+".Body",o),window.document.getElementById("irma-modal").classList.add("irma-show");var n,o;var i=window.document.getElementById("irma-cancel-button");i.addEventListener("click",(function t(){r()(e.u,{method:"DELETE"}),i.removeEventListener("click",t),_()}))}(e,t.options.language);case"canvas":var o=window.document.getElementById(t.options.element);if(!o)return Promise.reject("Specified canvas container not found in DOM");var i=document.createElement("img");i.src=p.a;var u=function(){t.canvas=function(e,t,n){var o=a()({text:t,render:"canvas",mode:"image",image:n,ecLevel:"M",rounded:50});return e.innerHTML="",e.appendChild(o),o}(o,"https://irma.app/-pilot/session#".concat(JSON.stringify(t.qr)),i)};i.complete?u():i.onload=u;break;case"console":v.generate(t.qr,t.options.qrterminalOptions,t.options.qrterminalDisplay)}return t.options.returnStatus===y.Initialized?(t.done=!0,y.Initialized):x(t.qr.u)})).catch((function(e){throw L("Error or unexpected status",e),"popup"===t.method&&_(),e}))}function A(e,t){return Promise.resolve().then((function(){if(t.done)return e;switch(L("Session state changed",e,t.qr.u),t.method){case"popup":B("irma-text","Messages.FollowInstructions",t.options.language);case"canvas":!function(e,t){var n=e.getContext("2d");if(n.clearRect(0,0,e.width,e.height),t){var o=window.devicePixelRatio;e.width=230*o,e.height=230*o,n.scale(o,o);var r=new Image;r.onload=function(){return n.drawImage(r,75.5,40,79,150)},r.src=d.a}}(t.canvas,t.options.showConnectedIcon)}return t.options.returnStatus===y.Connected?(t.done=!0,e):C(t.qr.u)})).then((function(e){if(t.done)return e;if("popup"===t.method&&_(),0===t.options.server.length)return t.done=!0,e;var n=t.options.legacyResultJwt?"getproof":"result-jwt",o=t.options.resultJwt||t.options.legacyResultJwt?n:"result";return J("".concat(t.options.server,"/session/").concat(t.options.token,"/").concat(o))})).then((function(e){return t.done?e:t.options.resultJwt||t.options.legacyResultJwt?e.text():e.json()})).catch((function(e){throw L("Error or unexpected status",e),"popup"===t.method&&_(),e}))}function R(e,t,n,o,r){return Promise.resolve().then((function(){return"object"===g(t)?"publickey"==n||"hmac"==n?M(t,n,o,r):JSON.stringify(t):t})).then((function(t){var r={};switch(n){case void 0:case"none":r["Content-Type"]="application/json";break;case"token":r.Authorization=o,r["Content-Type"]="application/json";break;case"publickey":case"hmac":r["Content-Type"]="text/plain";break;default:throw new Error("Unsupported authentication method")}return J("".concat(e,"/session"),{method:"POST",headers:r,body:t})})).then((function(e){return e.json()}))}function M(e,t,o,r){return Promise.resolve().then(n.t.bind(null,12,7)).then((function(n){var i;e.type||e["@context"]?i={request:e}:e.request&&(i=e);var s={disclosing:"verification_request",issuing:"issue_request",signing:"signature_request"},u={"https://irma.app/ld/request/disclosure/v2":"verification_request","https://irma.app/ld/request/signature/v2":"signature_request","https://irma.app/ld/request/issuance/v2":"issue_request"};if(!s[i.request.type]&&!u[i.request["@context"]])throw new Error("Not an IRMA session request");if("publickey"!==t&&"hmac"!==t)throw new Error("Unsupported signing method");var a={algorithm:"publickey"===t?"RS256":"HS256",issuer:r,subject:s[i.request.type]||u[i.request["@context"]]};return n.sign(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},{verification_request:"sprequest",issue_request:"iprequest",signature_request:"absrequest"}[a.subject],i),o,a)}))}function x(e){return D(e,y.Initialized).then((function(e){return e!==y.Connected&&e!==y.Done?Promise.reject(e):e}))}function C(e){return D(e,y.Connected).then((function(e){return e!==y.Done?Promise.reject(e):e}))}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.Initialized;return new Promise((function(n,o){var r=h?window.EventSource:b;if(!r)return L("No support for EventSource, fallback to polling"),void T("".concat(e,"/status"),t,n,o);var i=new r("".concat(e,"/statusevents")),s=setTimeout((function(){return o("no open message received")}),500);i.onopen=function(){clearTimeout(s)},i.onmessage=function(e){clearTimeout(s),i.close(),n(JSON.parse(e.data))},i.onerror=function(e){clearTimeout(s),L("Received server event error",e),i.close(),o(e)}})).catch((function(n){return L("error in server sent event, falling back to polling:",n),O("".concat(e,"/status"),t)}))}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.Initialized;return new Promise((function(n,o){return T(e,t,n,o)}))}var T=function e(t,n,o,r){return J(t).then((function(e){return e.json()})).then((function(i){return i!==n?o(i):setTimeout(e,500,t,n,o,r)})).catch((function(e){return r(e)}))},j={Desktop:"Desktop",Android:"Android",iOS:"iOS"};function P(e){return e.ok?e:e.text().then((function(t){throw function(){q&&console.warn.apply(console,arguments)}("Server returned error:",t),new Error(e.statusText)}))}function J(){return r.a.apply(null,arguments).then(P)}function _(){h&&window.document.getElementById("irma-modal")&&window.document.getElementById("irma-modal").classList.remove("irma-show")}function L(){q&&console.log.apply(console,arguments)}var N={disclosing:"Verify",issuing:"Issue",signing:"Sign"};function B(e,t,n){window.document.getElementById(e).innerText=function(e,t){var n=e.split("."),o=w[t];for(var r in n){if(void 0===o)break;o=o[n[r]]}if(void 0===o)for(var i in o=w[S.language],n){if(void 0===o)break;o=o[n[i]]}return void 0===o?"":o}(t,n)}function U(){return h?window.MSInputMethodContext&&document.documentMode?(L("Detected IE11"),j.Desktop):/Android/i.test(window.navigator.userAgent)?(L("Detected Android"),j.Android):/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?(L("Detected iOS"),j.iOS):(L("Neither Android nor iOS, assuming desktop"),j.Desktop):null}},function(e,t){e.exports=require("jsonwebtoken")}]));